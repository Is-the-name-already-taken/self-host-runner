services:
  github-runner:
    build:
      context: .
      dockerfile: dockerfile
      args:
        VERSION: ${VERSION}
        HASH: ${HASH}
        ORGANIZATION: ${ORGANIZATION}
        TOKEN: ${TOKEN}
        RUNNER_NAME: ${RUNNER_NAME}
        HOST_UID: ${HOST_UID}
        HOST_GID: ${HOST_GID}

    environment:
      - XDG_RUNTIME_DIR=/run/user/${HOST_UID}
      - CONTAINER_HOST=unix:///run/user/${HOST_UID}/podman/podman.sock

    image: localhost/self-host-runner_github-runner
      
    container_name: self-host-runner
    restart: "always"
    env_file:
      - .env
    volumes:
      - ${PODMAN_SOCKET_PATH}:/run/user/${HOST_UID}/podman/podman.sock
      - ./data:/data
